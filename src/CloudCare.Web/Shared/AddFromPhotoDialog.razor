@using CloudCare.Shared.DTOs.ExpenseTracker
@using Microsoft.AspNetCore.Components.Forms
@using MudBlazor

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">Add Expense from Photo</MudText>
    </TitleContent>
    <DialogContent>
        @if (_isLoading)
        {
            <MudProgressCircular Indeterminate="true" />
            <MudText>Processing your document...</MudText>
        }
        else
        {
            <MudFileUpload T="IBrowserFile" FilesChanged="OnFileChanged">
                <ActivatorContent>
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Primary"
                               StartIcon="@Icons.Material.Filled.CloudUpload">
                        Upload File
                    </MudButton>
                </ActivatorContent>
            </MudFileUpload>
            <MudText Typo="Typo.caption">Upload a photo or PDF of your receipt.</MudText>
        }
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; }

    private bool _isLoading = false;

    private async Task OnFileChanged(IBrowserFile file)
    {
        if (file == null) return;
        
        _isLoading = true;
        StateHasChanged();

        // Simulate OCR processing
        await Task.Delay(2000);

        var ocrResult = new ExpenseForCreationDto
        {
            Description = "Lunch from OCR",
            Amount = 15.99m,
            Date = DateOnly.FromDateTime(DateTime.Now),
            CategoryId = 1, // Dummy data
            VendorId = 1,   // Dummy data
            PaymentMethodId = 1
        };
        
        MudDialog.Close(DialogResult.Ok(ocrResult));
    }

    void Cancel() => MudDialog.Cancel();
}

